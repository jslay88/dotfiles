{{/* Chezmoi config template - prompts for machine-specific data on first init */}}

{{/* Detect OS and distro */}}
{{- $osType := .chezmoi.os -}}
{{- $isArch := false -}}
{{- $isMacOS := eq $osType "darwin" -}}
{{- if hasKey .chezmoi "osRelease" -}}
{{-   $isArch = eq (get .chezmoi.osRelease "id" | default "") "arch" -}}
{{- end -}}

{{/* Machine configuration - prompted interactively or read from existing config */}}
{{- $machineChoices := list "desktop" "laptop" "macmini" -}}
{{- $machineType := promptChoiceOnce . "machineType" "Machine type" $machineChoices -}}
{{- $personalName := promptStringOnce . "personalName" "Personal git username" -}}
{{- $personalEmail := promptStringOnce . "personalEmail" "Personal email for git" -}}
{{- $personalSigningKey := promptStringOnce . "personalSigningKey" "Personal GPG signing key ID (leave empty to disable signing)" -}}
{{- $hasWorkConfig := promptBoolOnce . "hasWorkConfig" "Do you have work git configuration" -}}
{{- $workName := "" -}}
{{- $workEmail := "" -}}
{{- $workSigningKey := "" -}}
{{- $workDir := "" -}}
{{- if $hasWorkConfig -}}
{{-   $workName = promptStringOnce . "workName" "Work git username" -}}
{{-   $workEmail = promptStringOnce . "workEmail" "Work email for git" -}}
{{-   $workSigningKey = promptStringOnce . "workSigningKey" "Work GPG signing key ID" -}}
{{-   $workDir = promptStringOnce . "workDir" "Work projects directory (e.g., ~/development/work)" -}}
{{- end -}}

# ╔══════════════════════════════════════════════════════════════════════════╗
# ║                         Chezmoi Configuration                            ║
# ╚══════════════════════════════════════════════════════════════════════════╝
# Auto-generated by chezmoi init
# Machine: {{ .chezmoi.hostname }}
# OS: {{ $osType }}

[data]
    # Machine identification
    machineType = {{ $machineType | quote }}
    isDesktop = {{ eq $machineType "desktop" }}
    isLaptop = {{ eq $machineType "laptop" }}
    isMacMini = {{ eq $machineType "macmini" }}
    
    # OS detection (computed)
    osType = {{ $osType | quote }}
    isLinux = {{ eq $osType "linux" }}
    isMacOS = {{ $isMacOS }}
    isArch = {{ $isArch }}
    
    # Personal git configuration
    personalName = {{ $personalName | quote }}
    personalEmail = {{ $personalEmail | quote }}
    personalSigningKey = {{ $personalSigningKey | quote }}
    
    # Work git configuration
    hasWorkConfig = {{ $hasWorkConfig }}
    workName = {{ $workName | quote }}
    workEmail = {{ $workEmail | quote }}
    workSigningKey = {{ $workSigningKey | quote }}
    workDir = {{ $workDir | quote }}

[edit]
    command = "nvim"

[diff]
    command = "nvim"
    args = ["-d"]
